const registerForm=document.forms.register,registerBtn=document.getElementById('register-btn'),username=document.getElementById('username'),name=document.getElementById('name'),email=document.getElementById('email'),password=document.getElementById('password'),country=document.getElementById('country'),usernameMsg=document.getElementById('username-msg'),emailMsg=document.getElementById('email-msg'),modalText=document.getElementById('modal-text');registerForm.addEventListener('submit',async function(c){c.preventDefault(),username.className='validate',email.className='validate',registerBtn.classList.add('disabled');try{const d=await fetch('/register',{headers:new Headers({'Content-Type':'application/json'}),method:'post',body:JSON.stringify({username:username.value,name:name.value,email:email.value,password:password.value,country:country.value})}),f=await d.json();f&&('u'===f.message[63]&&(username.className='validate invalid',usernameMsg.attributes[2].nodeValue='Username already taken.',registerBtn.classList.remove('disabled')),'e'===f.message[63]&&(email.className='validate invalid',emailMsg.attributes[2].nodeValue='Email already taken.',registerBtn.classList.remove('disabled')),'A'===f.message[0]&&(modalText.innerHTML=f.message,$('#modal').modal('open',{dismissible:!1}),setTimeout(()=>{location.href='/'},5e3)))}catch(d){console.log(d)}});async function getCountries(){try{const c=await fetch('/countries'),d=await c.json();sortByName(d),await d.forEach(f=>{registerForm.country.innerHTML+=`
      <option value="${f._id}" class="flag-img left valign-wrapper">${f.name}</option>
      `})}catch(c){console.log(c)}}function sortByName(c){return c.sort((d,f)=>{return d.name<f.name?-1:d.name>f.name?1:0})}registerForm.password.addEventListener('focus',function(){$('select').material_select()}),getCountries();