const addBeerForm=document.forms.addBeer;addBeerForm.style.onchange=function(){showMatchingCategories(this.value)},addBeerForm.country.onchange=function(){showMatchingBreweries(this.value)};async function showMatchingCategories(c){const d=document.getElementById('category-input-field'),f=addBeerForm.category,g=addBeerForm.otherCategory;try{const h=await fetch(`/styles/${c}/categories`),i=await h.json();0<i.length?(g.setAttribute('hidden',!0),g.removeAttribute('required'),d.classList.remove('hide'),f.innerHTML='',sortByName(i),i.forEach(j=>{f.innerHTML+=`<option value="${j._id}">${j.name}</option>`}),f.innerHTML+=`<option value="180158b3c3014c618706d0d7">Other</option>`,addBeerForm.category.onchange=function(){'180158b3c3014c618706d0d7'===this.value?(g.removeAttribute('hidden'),g.setAttribute('required',!0)):(g.setAttribute('hidden',!0),g.removeAttribute('required'))}):(d.classList.remove('hide'),f.innerHTML=`<option value="180158b3c3014c618706d0d7">Other</option>`,g.removeAttribute('hidden'),g.setAttribute('required',!0)),$('select').material_select()}catch(h){console.log(h),Materialize.toast(`Sorry, could not fetch categories`,2e3)}}async function showMatchingBreweries(c){const d=document.getElementById('brewery-input-field'),f=addBeerForm.brewery,g=addBeerForm.otherBrewery;try{const h=await fetch(`/countries/${c}/breweries`),i=await h.json();0<i.length?(g.setAttribute('hidden',!0),g.removeAttribute('required'),d.classList.remove('hide'),f.innerHTML='',sortByName(i),i.forEach(j=>{f.innerHTML+=`<option value="${j._id}">${j.name}</option>`}),f.innerHTML+=`<option value="f92603c88a6f4ae6a76d513a">Other</option>`,addBeerForm.brewery.onchange=function(){'f92603c88a6f4ae6a76d513a'===this.value?(g.removeAttribute('hidden'),g.setAttribute('required',!0)):(g.setAttribute('hidden',!0),g.removeAttribute('required'))}):(d.classList.remove('hide'),f.innerHTML=`<option value="f92603c88a6f4ae6a76d513a">Other</option>`,g.removeAttribute('hidden'),g.setAttribute('required',!0)),$('select').material_select()}catch(h){console.log(h),Materialize.toast(`Sorry, could not fetch breweries`,2e3)}}async function postBeer(){try{const c=await fetch('/beers/add',{headers:new Headers({'Content-Type':'application/json'}),method:'post',credentials:'same-origin',body:JSON.stringify({name:addBeerForm.name.value.trim(),style:addBeerForm.style.value,category:addBeerForm.category.value,country:addBeerForm.country.value,brewery:addBeerForm.brewery.value,description:addBeerForm.description.value.trim(),otherCategory:addBeerForm.otherCategory.value.trim(),otherBrewery:addBeerForm.otherBrewery.value.trim()})});if(201===c.status){const d=await c.json();Materialize.toast(`Your beer was created! Check it out <a href="/beers/${d._id}">here</a>`,1e4)}else Materialize.toast('Hmmm...Something went wrong. Check your input fields for special characters',5e3)}catch(c){console.log(c)}}function sortByName(c){return c.sort((d,f)=>{return d.name<f.name?-1:d.name>f.name?1:0})}function blockSpaceAsFirstInput(){const c=document.getElementsByTagName('input');for(const d of c)d.addEventListener('keydown',f=>{32===f.which&&0===f.target.selectionStart&&f.preventDefault()})}function addBeerFormListener(){addBeerForm.addEventListener('submit',c=>{c.preventDefault(),postBeer()})}addBeerFormListener(),blockSpaceAsFirstInput();