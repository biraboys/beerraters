function addContributionButtonsListeners(){document.getElementById('add-consume-button').onclick=()=>{addConsume()},document.getElementById('post-rating-button').onclick=()=>{addRatingSliderandFormListeners(),$('#rating-modal').modal('open')},document.getElementById('write-review-button').onclick=async()=>{addReviewFormListeners(),$('#review-modal').modal('open')},document.getElementById('upload-image-button').onclick=()=>{$('#image-modal').modal('open'),document.getElementById('upload-image-form').addEventListener('submit',a=>{a.preventDefault(),document.getElementById('loading-container').classList.add('active'),uploadImage()})}}function addRatingSliderandFormListeners(){document.getElementById('rating-slider').addEventListener('input',function(){changeSymbolColor(this.value)}),document.forms.ratingForm.addEventListener('submit',a=>{const b=document.getElementById('rating-slider').value;a.preventDefault(),postRating(b)})}function changeSymbolColor(a){const b=Array.from(document.getElementsByClassName('add-rating-symbol')),c=a-1,d=b[c],f=d.getAttribute('fill');'#E8EDFA'===f?b.forEach((g,h)=>{h<=c&&g.setAttribute('fill','#000000')}):b.forEach((g,h)=>{h>c&&g.setAttribute('fill','#E8EDFA')})}async function postRating(a){const b=document.getElementById('beer-name').innerHTML,c=location.href.split('/')[4];a=parseInt(a);try{const d=await fetch(`/beers/${c}/rating`,{method:'post',headers:new Headers({'Content-Type':'application/json'}),body:JSON.stringify({rating:a}),credentials:'same-origin'});201===d.status&&(await avgRatingSymbols(),updateRatingElementsInDom(b,a))}catch(d){Materialize.toast(`Sorry could not rate ${b}`,2e3)}}async function addConsume(){const a=document.getElementById('beer-name').innerText,b=location.href.split('/')[4];try{const c=await fetch(`/beers/${b}/consume`,{method:'post',credentials:'same-origin'});201===c.status&&updateConsumeElementsInDom(a)}catch(c){Materialize.toast(`Sorry could not drink ${a}`,2e3)}}async function getContributions(){const a=location.href.split('/')[4];try{const b=await fetch(`/beers/${a}/contributions`,{method:'get',credentials:'same-origin'});if(200===b.status){const c=await b.json();checkAndDisplayContributions(c)}}catch(b){console.log(b)}}async function avgRatingSymbols(){const a=document.getElementById('rating-container'),b=location.href.split('/')[4];try{const c=await fetch(`/beers/${b}/rating`,{method:'get',credentials:'same-origin'}),d=await c.json();if(0!==d){let f;switch(f=0==d%1?'int':'float',a.innerHTML='',f){case'int':for(let j=1;j<=d;j++)a.innerHTML+=`
          <svg class="va-middle avg-rating-star" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            <path d="M0 0h24v24H0z" fill="none"/>
          </svg>
        `;const g=document.getElementsByClassName('avg-rating-star').length;for(let j=g;5>j;j++)a.innerHTML+=`
          <svg class="va-middle avg-rating-star" fill="#E8EDFA" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            <path d="M0 0h24v24H0z" fill="none"/>
          </svg>
        `;a.innerHTML+=`
          <span class="va-middle card-subtitle">${d}</span>
          `;break;case'float':for(let j=1;j<=d;j++)a.innerHTML+=`
          <svg class="va-middle avg-rating-star" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            <path d="M0 0h24v24H0z" fill="none"/>
          </svg>
        `;a.innerHTML+=`
        <svg class="va-middle avg-rating-star" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <defs>
            <path d="M0 0h24v24H0V0z" id="a"/>
          </defs>
          <clipPath id="b">
            <use overflow="visible" xlink:href="#a"/>
          </clipPath>
          <path clip-path="url(#b)" d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4V6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"/>
        </svg>
         `;const h=document.getElementsByClassName('avg-rating-star').length;for(let j=h;5>j;j++)a.innerHTML+=`
          <svg class="va-middle avg-rating-star" fill="#E8EDFA" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            <path d="M0 0h24v24H0z" fill="none"/>
          </svg>
        `;a.innerHTML+=`
          <span class="va-middle card-subtitle">${d}</span>
          `;}}}catch(c){console.log(c)}}async function checkReviews(){const a=location.href.split('/')[4];try{const b=await fetch(`/beers/${a}/review`,{method:'get',credentials:'same-origin'});if(200===b.status){const c=await b.json();0<c.reviews.length&&c.reviews.forEach(async d=>{await getReviewUserImage(d)})}}catch(b){Materialize.toast('Sorry, could not get reviews',2e3)}}async function getReviewUserImage(a){try{const b=await fetch(`/users/${a.user_id}/profileImage`,{method:'get',credentials:'same-origin'});if(200===b.status){const c=await b.blob(),d=createUserImage(c);displayReview(a,d)}}catch(b){console.log(b)}}async function getBeerImages(){const a=location.href.split('/')[4],b=parseInt(document.getElementById('image-amount-span').innerText);if(0<b)try{for(let c=0;c<b;){const d=await fetch(`/beers/${a}/getImage`,{headers:new Headers({'Content-Type':'application/json'}),method:'post',credentials:'same-origin',body:JSON.stringify({index:c})});if(200===d.status){const f=await d.blob(),g=d.headers.get('User-Name');createBeerImage(f,g)}c++}$('.materialboxed').materialbox()}catch(c){console.log(c)}}async function getUploadedBeerImage(){const a=location.href.split('/')[4],b=parseInt(document.getElementById('image-amount-span').innerText)-1;try{const c=await fetch(`/beers/${a}/getImage`,{headers:new Headers({'Content-Type':'application/json'}),method:'post',credentials:'same-origin',body:JSON.stringify({index:b})});if(200===c.status){const d=await c.blob(),f=c.headers.get('User-Name');createBeerImage(d,f)}$('.materialboxed').materialbox()}catch(c){console.log(c)}}function addReviewFormListeners(){const a=location.href.split('/')[4],b=document.forms.reviewForm,c=document.getElementById('review-label'),d=document.getElementById('review');b.addEventListener('submit',async function(f){if(f.preventDefault(),!(0<d.value.length&&121>d.value.length))120<d.value.length?(d.classList.add('invalid'),c.innerHTML='Too many characters.',c.style.color='#F44336'):(d.classList.add('invalid'),c.innerHTML='Please enter some text here...',c.style.color='#F44336');else if(!d.value.replace(/\s/g,'').length)c.classList.add('invalid'),c.innerHTML=`This seems like a funny review... eh?`,c.style.color='#F44336';else try{const g=await fetch(`/beers/${a}/review`,{headers:new Headers({'Content-Type':'application/json'}),method:'post',credentials:'same-origin',body:JSON.stringify({place:b.place.value,review:b.review.value})});if(201===g.status){const h=await g.json();console.log(h),getReviewUserImage(h),updateReviewElementsInDom()}}catch(g){Materialize.toast(`Sorry could not review beer`,2e3)}})}function createUserImage(a){const b=document.createElement('img'),c=URL.createObjectURL(a);return b.src=c,b.setAttribute('class','circle'),b}function createBeerImage(a,b){const c=document.getElementById('beer-image-container'),d=document.createElement('img'),f=URL.createObjectURL(a),g=document.createElement('div');g.setAttribute('class','col s6 m3 l2'),g.style.padding='0',d.src=f,d.setAttribute('class','responsive-img materialboxed caption-images'),d.setAttribute('data-caption',`Posted by ${b}`),g.appendChild(d),c.insertAdjacentElement('afterbegin',g)}function checkAndDisplayContributions(a){const b=a.user_id,c=a.beer,d=c.ratings.map(m=>m.user),f=c.images.map(m=>m.user_id),g=c.reviews.map(m=>m.user_id),h=document.getElementById('add-consume-button'),j=document.getElementById('upload-image-button'),k=document.getElementById('post-rating-button'),l=document.getElementById('write-review-button');c.consumes.includes(b)||(h.style.display='inline-block'),g.includes(b)||(l.style.display='inline-block'),f.includes(b)||(j.style.display='inline-block'),d.includes(b)||(k.style.display='inline-block')}function updateRatingElementsInDom(a,b){let c=document.getElementById('rating-amount-span').innerText,d=parseInt(c);document.getElementById('post-rating-button').style.display='none',d++,document.getElementById('rating-amount-span').innerText=d,$('#rating-modal').modal('close'),Materialize.toast(`You rated ${a} ${b}`,2e3)}function updateConsumeElementsInDom(a){let b=document.getElementById('consume-amount-span').innerText,c=parseInt(b);document.getElementById('add-consume-button').style.display='none',c++,document.getElementById('consume-amount-span').innerText=c,Materialize.toast(`Hope your ${a} tasted good!`,2e3)}function updateReviewElementsInDom(){let a=document.getElementById('review-amount-span').innerText,b=parseInt(a);document.getElementById('write-review-button').style.display='none',b++,null!==document.getElementById('no-reviews-message')&&$('#no-reviews-message').remove(),document.getElementById('review-amount-span').innerText=b,$('#review-modal').modal('close'),Materialize.toast(`Your review was posted!`,2e3)}function displayReview(a,b){const c=document.getElementById('reviews-container'),d=`
  <div class="card-panel col s12 m4">
    <li class="collection-item avatar">
      ${b.outerHTML}
      <span class="title"><a href="/users/${a.user_id}"><strong>${a.user_username}</strong></a></span>
      <p>
        <span class="card-subtitle">${a.place}</span>
        <br>
        ${a.body}
      </p>
    </li>
  </div>
`;c.insertAdjacentHTML('afterbegin',d)}async function uploadImage(){const a=location.href.split('/')[4],b=document.getElementById('upload-image-form');try{const c=new FormData(b),d=await fetch(`/beers/${a}/addImage`,{method:'post',credentials:'same-origin',body:c});201===d.status&&(updateImageElementsInDom(),getUploadedBeerImage())}catch(c){console.log(c),Materialize.toast('Sorry, could not post your photo',2e3)}}function updateImageElementsInDom(){let a=document.getElementById('image-amount-span').innerText,b=parseInt(a);document.getElementById('upload-image-button').style.display='none',b++,document.getElementById('image-amount-span').innerText=b,null!==document.getElementById('no-images-message')&&$('#no-images-message').remove(),document.getElementById('loading-container').classList.remove('active'),$('#image-modal').modal('close'),Materialize.toast('Your photo was posted!',2e3)}(async()=>{await Promise.all([getBeerImages(),getContributions(),checkReviews()]),addContributionButtonsListeners(),avgRatingSymbols()})();